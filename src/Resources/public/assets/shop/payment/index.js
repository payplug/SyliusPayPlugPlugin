!function(){const e={options:{trigger:".payment-method-choice",completeInfo:{modal:".oney-complete-info-popin",area:".ui.grid"}},init(t){void 0===t&&(t=this.options),this.options=$.extend(!0,{},t),e.toggleGateway(),"undefined"!=typeof completeInfoRoute&&e.modalAppear(),e.tabs(),$(window).on("resize",(()=>{setTimeout(e.tabs,100)})),e.tabsHandler(),e.applePayHandler(),$('form[name="sylius_checkout_select_payment"]').on("submit",(()=>{e.handleForm()}))},toggleGateway(){const e=$(this.options.trigger).data("payment-input-id");$(`#${e}:checked`).length&&$(`.payment-method-choice[data-payment-input-id="${e}"]`).show(),$("input[id*=sylius_checkout_select_payment]").on("change",(e=>{const t=$(e.currentTarget).attr("id");$(".payment-method-choice").slideUp(),$(`.payment-method-choice[data-payment-input-id="${t}"]`).slideDown()}))},tabs(){window.innerWidth<=991?($(".oney-payment-choice__item").hide(),setTimeout((()=>{$.each($(".oney-payment-choice__input"),((e,t)=>{$(t).is(":checked")&&($(t).parent().show(),$(`a.tablink[data-id=${$(t).val()}]`).addClass("active"))}))}),1)):($(".oney-payment-choice__item").show(),$("a.tablink").removeClass("active"))},tabsHandler(){$.each($("a.tablink"),((e,t)=>{$(t).click((function(e){$("a.tablink").removeClass("active"),$(this).addClass("active"),$(".oney-payment-choice__item").hide(),$(`#${$(this).data("id")}`).show(),$(`input[value=${$(this).data("id")}`).prop("checked",!0)}))}))},disableNextStepButton(){const e=$('form[name="sylius_checkout_select_payment"] .select-payment-submit #next-step');e.replaceWith($("<span/>",{id:"next-step",class:"ui large disabled icon labeled button",html:e.html()}))},enableNextStepButton(){const e=$('form[name="sylius_checkout_select_payment"] .select-payment-submit #next-step');e.replaceWith($("<button/>",{type:"submit",id:"next-step",class:"ui large primary icon labeled button",html:e.html()}))},showApplePayButton(){const e=$(document).find("apple-pay-button");e.length&&e.addClass("enabled")},hideApplePayButton(){const e=$(document).find("apple-pay-button.enabled");e.length&&e.removeClass("enabled")},applePayHandler(){const t=$(".payment-item .checkbox-applepay input:radio");t&&(t.is(":checked")?(e.disableNextStepButton(),e.showApplePayButton()):(e.enableNextStepButton(),e.hideApplePayButton())),$(".payment-item .checkbox input:radio").on("change",this.onPaymentMethodChoice),$(document).find("apple-pay-button").on("click",this.onApplePayButtonClick)},onPaymentMethodChoice(t){$(t.currentTarget).closest(".checkbox-applepay").length?(e.showApplePayButton(),e.disableNextStepButton()):(e.hideApplePayButton(),e.enableNextStepButton())},onApplePayButtonClick(e){const t=$(e.currentTarget);if(void 0===applePaySessionRequestSettings)return console.error("Invalid Apple Pay settings!"),!1;const o=new ApplePaySession(3,applePaySessionRequestSettings);o.onvalidatemerchant=async e=>{$.ajax({url:t.data("validate-merchant-route"),method:"POST",cache:!1,data:{},success:e=>{let t=e.merchant_session;console.log(t),!0===e.success?(console.log(e.merchant_session),o.completeMerchantValidation(t)):o.abort()},error:(e,t,a)=>{console.log(e,t,a),o.abort(),window.location.reload()}})},o.onpaymentauthorized=e=>{$.ajax({url:t.data("payment-authorized-route"),method:"POST",cache:!1,data:{token:e.payment.token},success:e=>{try{var t=ApplePaySession.STATUS_SUCCESS;console.log(e),console.log(e.data.responseToApple.status),1!=e.data.responseToApple.status&&(t=ApplePaySession.STATUS_FAILURE);const a={status:t};console.log(t),console.log(a),o.completePayment(a),console.log(e.data.returnUrl),window.location.href=e.data.returnUrl}catch(e){console.error(e),window.location.reload()}},error:(e,t,a)=>{console.log(e,t,a),o.abort(),window.location.reload()}})},o.oncancel=e=>{console.log("Cancelling Apple Pay session!"),$.ajax({url:t.data("session-cancel-route"),cache:!1,method:"POST",data:{},success:e=>{console.log("Cancelled!"),console.log(e.data.returnUrl),window.location.href=e.data.returnUrl},error:(e,t,o)=>{console.log(e,t,o),window.location.reload()}})},o.begin()},modalAppear(){const e=this;let t=completeInfoRoute;$.get(t).then((t=>{$("body .pusher").append("<div class='overlay'></div>"),$(e.options.completeInfo.area).addClass("inactive"),$(e.options.completeInfo.area).parent().append(t),e.modalEvents()}))},modalFadeaway(){$(this.options.completeInfo.modal).fadeOut(300,(()=>{$(this.options.completeInfo.area).removeClass("inactive"),$(".overlay").hide()}))},modalSubmit(e){const t=this;e.preventDefault(),$(e.currentTarget).addClass("loading"),$.ajax({method:"post",url:completeInfoRoute,data:$(e.currentTarget).serialize(),success:function(e){Array.isArray(e)?($(`${t.options.completeInfo.modal}__content`).fadeOut((()=>{$(`${t.options.completeInfo.modal}__success`).show()})),setTimeout((()=>{t.modalFadeaway()}),2500)):$(t.options.completeInfo.modal).html(e),t.modalEvents()},error:function(e){console.log(e)}})},modalEvents(){$(".close").on("click",(()=>{this.modalFadeaway()})),$("form[name=form]").on("submit",(e=>{this.modalSubmit(e)}))},handleForm(){$(".checkbox-oney :radio:checked").length?$(".checkbox-payplug").closest(".payment-item").find(".payment-choice__input:checked").prop("checked",!1):$(".checkbox-payplug :radio:checked").length&&$(".checkbox-oney").closest(".payment-item").find(".payment-choice__input:checked").prop("checked",!1),$("input#payplug_choice_card_other").attr("disabled",!0),$('form[name="sylius_checkout_select_payment"]').submit()}};document.addEventListener("DOMContentLoaded",e.init,!1)}();