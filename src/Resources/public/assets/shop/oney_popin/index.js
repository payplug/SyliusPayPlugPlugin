!function(){const t={handlers:{info:".oney-info",popin:".oney-popin",codes:"#payplug-product-variant-codes"},triggers:{option:"cartItem_variant",quantity:"cartItem_quantity"},productMeta:[],storage:[],init(){"undefined"!=typeof productMeta&&t.watch(),t.fade(),t.closeHandler()},watch(){for(const t in this.triggers){const e=$(`[id*=${this.triggers[t]}`);e.length>0&&this.handleProductOptionsChange(e,t),productMeta[t]=e.val(),e.on("input",this.debounce((a=>{a.preventDefault(),e.length>0&&this.handleProductOptionsChange(e,t),productMeta[t]=$(a.currentTarget).val(),this.check()}),500))}this.productMeta=productMeta},handleProductOptionsChange(t,e){if("option"===e){let e="";return t.each(((t,a)=>{const n=$(a),s=n.find("option:selected").val();e+=`[data-${n.attr("data-option")}="${s}"]`})),productMeta.product_variant_code=$(this.handlers.codes).find(e).attr("data-value")}},check(){const t=this;this.storage=[],$.ajax({url:this.productMeta.url,data:this.productMeta,success:function(e){$(t.handlers.info).find("img:first").attr("src",t.productMeta.img[e.isEligible]),e.isEligible?$(t.handlers.popin).removeClass("disabled").addClass("enabled"):$(t.handlers.popin).removeClass("enabled").addClass("disabled")}})},debounce(t,e){let a;return function(...n){clearTimeout(a),a=setTimeout((()=>{clearTimeout(a),t(...n)}),e)}},fade(){$(this.handlers.info).on("click",(t=>{t.preventDefault(),t.stopPropagation(),$(this.handlers.popin).is(":empty")||$(this.handlers.popin).text().trim()!==this.storage?(this.toggleLoader(),this.load()):$(this.handlers.popin).fadeIn()}))},load(){const e=this;$.ajax({url:$(this.handlers.popin).data("popin-url"),data:this.productMeta,success:function(t){t.includes(translations.reason)&&$(e.handlers.popin).removeClass("enabled").addClass("disabled"),e.storage=$(t).text().trim(),$(e.handlers.popin).html(t)},error:function(){$(e.handlers.popin).removeClass("enabled").addClass("disabled").html(`\n            <div class="oney-popin__header">\n              <a class="close" href="javascript:void(0);" title="${translations.close}">\n                  <span></span><span></span>\n              </a>\n            </div>\n            <div class="oney-popin__content">\n              <p class="reasons">${translations.reason}</p>\n            </div>\n          `)},complete:function(){e.toggleLoader(),$(e.handlers.popin).fadeIn(),t.closeHandler()}})},toggleLoader(){$(this.handlers.info).toggleClass("loading").find(".dimmer").toggleClass("active")},closeHandler(){$("html").not(this.handlers.popin).on("click",(t=>{t.stopPropagation(),$(this.handlers.popin).fadeOut()})),$(this.handlers.popin).find("a.close").on("click",(t=>{t.stopPropagation(),$(this.handlers.popin).fadeOut()}))}};document.addEventListener("DOMContentLoaded",t.init,!1)}();